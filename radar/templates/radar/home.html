{% extends "radar/base.html" %}
{% load static %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'radar/styles/home.css' %}" />
{% endblock %}

{% block content %}
<div class="mediaradar__wrapper container">
  <div class="mediaradar__search form__wrapper">
    <h2 class="search__title">Поиск</h2>
    <form method="get" class="search__form input-form">
      <input name="q" class="search__input" value="{{ q }}" placeholder="Введите название...">
      <button class="search__btn btn btn--search" type="submit">Искать</button>
    </form>
  </div>
  <div class="mediaradar__catalog">
    {% if q %}
      <h2 class="catalog__title">Результаты поиска</h2>
      <ul class="catalog__list">
        {% for t_context in result %}
          <li class="catalog__item">
            {% if t_context.action == "add" %}
              <form method="post" action="{% url 'subscriptions_add' %}" class="item__action-form">
                  {% csrf_token %}
                  <input type="hidden" name="source" value="{{ t_context.title.source.value }}">
                  <input type="hidden" name="external_id" value="{{ t_context.title.external_id }}">
                  <button type="submit">
                      <img src="{% static 'radar/icons/add.svg' %}" alt="add" class="item__icon--add item__icon-action">
                  </button>
              </form>

            
            {% elif t_context.action == "delete" %}
              <form method="post" action="{% url 'subscriptions_delete' %}" class="item__action-form">
                {% csrf_token %}
                <input type="hidden" name="source" value="{{ t_context.title.source.value }}">
                <input type="hidden" name="external_id" value="{{ t_context.title.external_id }}">
                <button type="submit">
                  <img src="{% static 'radar/icons/delete.svg' %}" alt="delete" class="item__icon--delete item__icon-action">
                </button>
              </form>
            {% endif %}
            <a href="" class="item__link">
              {% if t_context.title.cover_url %}
              <img src="{{ t_context.title.cover_url }}" alt="cover" class="item__cover">
              {% else %}
              <img src="https://mobius-lubes.com/wp-content/uploads/2025/09/empty-img.webp" alt=""
                class="item__empty-cover">
              {% endif %}
              <span class="item__name">{{ t_context.title.name|truncatechars:20 }}</span>
            </a>
          </li>
        {% empty %}
          <p class="catalog__empty">Ничего не найдено...</p>
        {% endfor %}
      </ul>
    {% endif %}
  </div>
</div>
{% endblock %}