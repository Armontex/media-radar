<div class="telegram-widjet-auth">
  <script
    async
    src="https://telegram.org/js/telegram-widget.js?22"
    data-telegram-login="mediaradarbot"
    data-size="medium"
    data-radius="5"
    data-onauth="onTelegramAuth(user)"
    data-request-access="write"
  ></script>
  <script>
    const csrftoken = document.cookie
      .split("; ")
      .find((row) => row.startsWith("csrftoken="))
      ?.split("=")[1];

    function onTelegramAuth(user) {
      fetch("/auth/telegram/", {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
          "X-CSRFToken": decodeURIComponent(csrftoken || ""),
        },
        body: JSON.stringify(user),
      })
        .then((res) => res.json())
        .then((data) => {
          if (data.status === "ok") {
            window.location = "/profile/";
          }
        });
    }
  </script>
</div>
