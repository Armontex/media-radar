# Техническое задание на проект: MediaRadar

## 1) Цель проекта

MediaRadar - веб‑сервис подписки на релизы медиа‑контента для занятых пользователей с целью автоматических уведомлений о новых выпусках.  

Проблема: пользователь не хочет вручную отслеживать выход новых серий/глав/выпусков и пропускать релизы.

## 2) Целевая аудитория и роли

Целевая аудитория: пользователи, которые регулярно смотрят/читают сериалы, аниме и хотят получать уведомления о новых релизах.

Роли:

- Гость: может просматривать публичные страницы (описание сервиса), перейти к регистрации/входу.
- Пользователь (авторизованный): ищет тайтлы, подписывается/отписывается, просматривает "Мои подписки".
- Администратор: управляет контентом в админке, модерирует данные, может принудительно отключать подписки/уведомления при необходимости.

## 3) Модели данных (сущности)

Проект подразумевает не менее 3 связанных кастомных моделей и корректные связи (ForeignKey/ManyToMany).

### 3.1 Title (Тайтл / Контент)

Сущность "что отслеживаем".

Ключевые поля:

- `id` - идентефикатор.
- `name` - название тайтла.
- `descr` - краткое описание.
- `cover_url` - ссылка на обложку/постер.
- `external_id` - идентификатор во внешнем источнике.
- `source` - источник данных.
- `is_active` - активен ли тайтл для мониторинга.
- `created_at` - когда была создана запись в бд.

### 3.2 Release (Выпуск/Релиз)

Сущность "что нового вышло".

Ключевые поля:

- `title` - ForeignKey на Title.
- `number` - номер серии/главы (опционально).
- `season` - номер сезона (опционально)
- `released_at` - дата/время релиза (если известно).
- `descr` - короткое описание (опционально).
- `external_release_id` - идентификатор во внешнем источнике (на будущем этапе).
- `created_at` - когда запись добавлена в систему.

### 3.3 Subscription (Подписка)

Связь "пользователь подписан на тайтл".

Ключевые поля:

- `user` - ForeignKey на User.
- `title` - ForeignKey на Title.
- `is_active` - активна ли подписка.
- `created_at` - дата подписки.
- `last_notified_release` - ссылка на последний релиз, о котором уже уведомили (ForeignKey на Release, nullable), чтобы не слать повторно.
- `notify_channel` - канал уведомлений (email/telegram).

Ограничения:

- Уникальность пары (`user`, `title`) чтобы не было дублей подписок.

### 3.4 NotificationLog (Журнал уведомлений)

Фиксация факта отправки/показа уведомления.

Ключевые поля:

- `user` - ForeignKey на User.
- `title` - ForeignKey на Title.
- `release` - ForeignKey на Release.
- `channel` - канал (email/telegram/внутренние).
- `status` - успех/ошибка/ожидает.
- `sent_at` - когда отправлено/показано.

## 4) Ключевой функционал (User Stories)

### 4.1 Аутентификация и профиль

- Пользователь может зарегистрироваться и войти в систему.

### 4.2 Поиск и карточка тайтла

- Пользователь видит строку поиска и может ввести название тайтла.
- Система показывает результаты поиска (список карточек).

### 4.3 Подписки

- Пользователь может подписаться на тайтл из карточки.
- Пользователь может открыть страницу "Мои подписки" и увидеть список всех подписок.
- Пользователь может отписаться от тайтла.
- Если на тайтл больше никто не подписан, тайтл либо удаляется, либо помечается и перестает проверяться.  

### 4.4 Обновления и уведомления

- Система периодически проверяет обновления только для тайтлов, у которых есть активные подписки.
- Если найден новый релиз, система отправляет уведомления подписчикам.
- Система не отправляет повторное уведомление об одном и том же релизе. (только если status-уведомления не error)

## 5) Внешние интеграции / Аналитика (техническая нагрузка)

Внешние API: 

1) TVMaze API (поиск тайтлов)
2) Telegram API (авторизация)

## 6) Основные страницы (структура интерфейса)

- Главная: кнопки "Профиль" (с автоматической переадрисацией), "Мои подписки" и каталог.
- Поиск: строка поиска + результаты.
- Страница тайтла: описание, кнопка "Подписаться/Отписаться".
- "Мои подписки": список подписок, быстрые действия (отписаться).
- Админка Django: управление Title/Release/Subscription/NotificationLog

## 7) Изменения в ходе реализации

- Пользователь не будет видеть историю уведомлений
- Пользователь может изменить базовые настройки уведомлений (включено/выключено). (Убрано)
- Пользователь открывает карточку тайтла и видит описание. (Убрано)
- "Аналитика": топ тайтлов по подпискам + базовые счётчики. (Убрано, на будущее)
